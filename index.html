<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facilitation Needs Logger</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            font-size: 16px;
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #6c757d;
            color: white;
            transition: all 0.2s;
        }
        button:hover { background-color: #495057; }
        button:active { background-color: #343a40; }
        button:disabled { background-color: #aaa; cursor: not-allowed; }

        .content {
            display: flex;
            gap: 20px;
            justify-content: space-between;
        }

        #videoContainer {
            width: 60%;
            padding: 10px;
            background-color: #f0f0f0;
            text-align: center;
        }
        .logButtons {
            width: 40%;
        }

        .metaButton {
            width: 100%; 
            padding: 10px; 
            font-size: 14px; 
            background-color: #d0e1f9;
            color: #004085;
            border: 1px solid #b0c4de;
            margin-bottom: 5px;
        }
        .metaButton:hover { background-color: #a4c6f8; }
        .metaButton:active { background-color: #007bff; color: white; }

        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
            background: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th { background-color: #343a40; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ミーティング・ファシリテーション・ニーズ・ロガー</h1>

        <!-- Control Buttons -->
        <div class="controls">
            <button id="playButton" disabled>再生</button>
            <button id="pauseButton" disabled>一時停止</button>
            <button id="stopButton" disabled>停止</button>
            <button id="clearButton">ログをクリア</button>
            <button id="exportButton" disabled>ログをエクスポート</button>
        </div>

        <!-- Video & Log Buttons Side by Side -->
        <div class="content">
            <div id="videoContainer">
                <input type="file" id="videoUpload" accept="video/*">
                <video id="videoPlayer" width="100%" controls></video>
            </div>

            <div class="logButtons">
                <h2>思考ログ</h2>
                <p>議論の流れを意識し、次に必要なアクションを記録しましょう。</p>
                <button class="metaButton" onclick="logMeta('進行を管理する')">進行を管理する</button>
                <button class="metaButton" onclick="logMeta('意見を共有する')">意見を共有する</button>
                <button class="metaButton" onclick="logMeta('質問・明確化する')">質問・明確化する</button>
                <button class="metaButton" onclick="logMeta('議論を活性化する')">議論を活性化する</button>
                <button class="metaButton" onclick="logMeta('結論をまとめる')">結論をまとめる</button>
                <button class="metaButton" onclick="logMeta('タスクを決める')">タスクを決める</button>
            </div>
        </div>

        <!-- Log Table at the Bottom -->
        <h2>記録されたログ</h2>
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>ビデオ時間 (HH:MM:SS)</th>
                    <th>思考ログ</th>
                </tr>
            </thead>
            <tbody id="logTable"></tbody>
        </table>
    </div>

    <script>
        let logs = [];
        let videoFileName = "log"; // Default name

        const videoUpload = document.getElementById("videoUpload");
        const videoPlayer = document.getElementById("videoPlayer");

        videoUpload.addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                videoFileName = file.name.split('.').slice(0, -1).join('.'); // Get filename without extension
                videoPlayer.src = URL.createObjectURL(file);
                videoPlayer.load();
                document.getElementById("playButton").disabled = false;
                document.getElementById("exportButton").disabled = logs.length === 0;
            }
        });

        document.getElementById("playButton").addEventListener("click", function() {
            videoPlayer.play();
            this.disabled = true;
            document.getElementById("pauseButton").disabled = false;
            document.getElementById("stopButton").disabled = false;
        });

        document.getElementById("pauseButton").addEventListener("click", function() {
            videoPlayer.pause();
            document.getElementById("playButton").disabled = false;
        });

        document.getElementById("stopButton").addEventListener("click", function() {
            videoPlayer.pause();
            videoPlayer.currentTime = 0;
            document.getElementById("playButton").disabled = false;
            this.disabled = true;
            document.getElementById("pauseButton").disabled = true;
        });

        function formatTime(seconds) {
            let h = Math.floor(seconds / 3600);
            let m = Math.floor((seconds % 3600) / 60);
            let s = Math.floor(seconds % 60);
            return [h, m, s].map(n => String(n).padStart(2, '0')).join(":");
        }

        function logMeta(metaLog) {
            let elapsedTime = formatTime(videoPlayer.currentTime);
            logs.push({ elapsedTime, metaLog });
            updateTable();
            document.getElementById("exportButton").disabled = false;
        }

        function updateTable() {
            const table = document.getElementById("logTable");
            table.innerHTML = "";
            logs.forEach((log, index) => {
                const row = table.insertRow();
                row.insertCell(0).innerText = index + 1;
                row.insertCell(1).innerText = log.elapsedTime;
                row.insertCell(2).innerText = log.metaLog;
            });
        }

        document.getElementById("clearButton").addEventListener("click", function() {
            if (confirm("ログをすべてクリアしますか？")) {
                logs = [];
                updateTable();
                document.getElementById("exportButton").disabled = true;
            }
        });

        document.getElementById("exportButton").addEventListener("click", function() {
            const today = new Date().toISOString().slice(0, 10);
            const fileName = `${videoFileName}_${today}.json`;

            const logData = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(logs, null, 2));
            const logAnchor = document.createElement("a");
            logAnchor.setAttribute("href", logData);
            logAnchor.setAttribute("download", fileName);
            document.body.appendChild(logAnchor);
            logAnchor.click();
            document.body.removeChild(logAnchor);
        });

    </script>
</body>
</html>
